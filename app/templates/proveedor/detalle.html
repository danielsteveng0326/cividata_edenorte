<!-- templates/proveedor/detalle.html -->
{% extends 'base.html' %}
{% load static %}

{% block title %}Detalle del Proveedor{% endblock %}

{% block content %}
<div class="content-wrapper">
    <div class="content-header">
        <div class="container-fluid">
            <div class="row mb-2">
                <div class="col-sm-6">
                    <h1 class="m-0">
                        <i class="fas fa-eye"></i> Detalle del Proveedor
                    </h1>
                </div>
                <div class="col-sm-6">
                    <ol class="breadcrumb float-sm-right">
                        <li class="breadcrumb-item"><a href="{% url 'dashboard:dashboard' %}">Inicio</a></li>
                        <li class="breadcrumb-item"><a href="{% url 'proveedor:index' %}">Proveedores</a></li>
                        <li class="breadcrumb-item active">Detalle</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>

    <section class="content">
        <div class="container-fluid">
            
            <!-- Información Principal -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-building"></i> {{ proveedor.nombre }}
                    </h3>
                    <div class="card-tools">
                        {% if proveedor.es_activo %}
                            <span class="badge badge-success">Activo</span>
                        {% else %}
                            <span class="badge badge-secondary">Inactivo</span>
                        {% endif %}
                        {% if proveedor.es_pyme %}
                            <span class="badge badge-warning">PyME</span>
                        {% endif %}
                    </div>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <table class="table table-borderless">
                                <tr>
                                    <td><strong>NIT:</strong></td>
                                    <td>{{ proveedor.nit }}</td>
                                </tr>
                                <tr>
                                    <td><strong>Código:</strong></td>
                                    <td>{{ proveedor.codigo|default:"No asignado" }}</td>
                                </tr>
                                <tr>
                                    <td><strong>Teléfono:</strong></td>
                                    <td>{{ proveedor.telefono|default:"No registrado" }}</td>
                                </tr>
                                <tr>
                                    <td><strong>Correo:</strong></td>
                                    <td>{{ proveedor.correo|default:"No registrado" }}</td>
                                </tr>
                                <tr>
                                    <td><strong>Sitio Web:</strong></td>
                                    <td>
                                        {% if proveedor.sitio_web %}
                                            <a href="{{ proveedor.sitio_web }}" target="_blank">{{ proveedor.sitio_web }}</a>
                                        {% else %}
                                            No registrado
                                        {% endif %}
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="col-md-6">
                            <table class="table table-borderless">
                                <tr>
                                    <td><strong>Tipo de Empresa:</strong></td>
                                    <td>{{ proveedor.tipo_empresa }}</td>
                                </tr>
                                <tr>
                                    <td><strong>País:</strong></td>
                                    <td>{{ proveedor.pais|default:"No registrado" }}</td>
                                </tr>
                                <tr>
                                    <td><strong>Departamento:</strong></td>
                                    <td>{{ proveedor.departamento|default:"No registrado" }}</td>
                                </tr>
                                <tr>
                                    <td><strong>Municipio:</strong></td>
                                    <td>{{ proveedor.municipio|default:"No registrado" }}</td>
                                </tr>
                                <tr>
                                    <td><strong>Fecha de Registro:</strong></td>
                                    <td>{{ proveedor.fecha_registro|date:"d/m/Y H:i" }}</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                    
                    {% if proveedor.direccion %}
                    <div class="row">
                        <div class="col-12">
                            <strong>Dirección:</strong> {{ proveedor.direccion }}
                        </div>
                    </div>
                    {% endif %}
                </div>
                <div class="card-footer">
                    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#editModal">
                        <i class="fas fa-edit"></i> Editar Información
                    </button>
                    <a href="{% url 'proveedor:listar' %}" class="btn btn-secondary">
                        <i class="fas fa-arrow-left"></i> Volver a Lista
                    </a>
                </div>
            </div>

            <!-- Representante Legal (si aplica) -->
            {% if necesita_rep_legal %}
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-user-tie"></i> Representante Legal
                    </h3>
                </div>
                <div class="card-body">
                    {% if proveedor.nombre_representante_legal %}
                    <div class="row">
                        <div class="col-md-6">
                            <table class="table table-borderless">
                                <tr>
                                    <td><strong>Nombre:</strong></td>
                                    <td>{{ proveedor.nombre_representante_legal }}</td>
                                </tr>
                                <tr>
                                    <td><strong>Tipo de Documento:</strong></td>
                                    <td>{{ proveedor.tipo_doc_representante_legal|default:"No registrado" }}</td>
                                </tr>
                                <tr>
                                    <td><strong>Número de Documento:</strong></td>
                                    <td>{{ proveedor.n_mero_doc_representante_legal|default:"No registrado" }}</td>
                                </tr>
                            </table>
                        </div>
                        <div class="col-md-6">
                            <table class="table table-borderless">
                                <tr>
                                    <td><strong>Teléfono:</strong></td>
                                    <td>{{ proveedor.telefono_representante_legal|default:"No registrado" }}</td>
                                </tr>
                                <tr>
                                    <td><strong>Correo:</strong></td>
                                    <td>{{ proveedor.correo_representante_legal|default:"No registrado" }}</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                    {% else %}
                    <p class="text-muted">No hay información del representante legal registrada.</p>
                    {% endif %}
                </div>
            </div>
            {% endif %}

            <!-- Información Adicional -->
            {% if proveedor.descripcion_categoria_principal or proveedor.camaras_comercio %}
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-info-circle"></i> Información Adicional
                    </h3>
                </div>
                <div class="card-body">
                    {% if proveedor.descripcion_categoria_principal %}
                    <div class="mb-3">
                        <strong>Categoría Principal:</strong>
                        <p>{{ proveedor.descripcion_categoria_principal }}</p>
                    </div>
                    {% endif %}
                    
                    {% if proveedor.camaras_comercio %}
                    <div class="mb-3">
                        <strong>Cámaras de Comercio:</strong>
                        <p>{{ proveedor.camaras_comercio }}</p>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endif %}

        </div>
    </section>
</div>

<!-- Modal de Edición -->
<div class="modal fade" id="editModal" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-edit"></i> Editar Proveedor
                </h5>
                <button type="button" class="close" data-dismiss="modal">
                    <span>&times;</span>
                </button>
            </div>
            <form method="POST">
                {% csrf_token %}
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="edit_nombre">Nombre / Razón Social</label>
                                <input type="text" 
                                       id="edit_nombre" 
                                       name="nombre" 
                                       class="form-control" 
                                       value="{{ proveedor.nombre }}">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="edit_telefono">Teléfono</label>
                                <input type="text" 
                                       id="edit_telefono" 
                                       name="telefono" 
                                       class="form-control" 
                                       value="{{ proveedor.telefono }}">
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="edit_correo">Correo Electrónico</label>
                                <input type="email" 
                                       id="edit_correo" 
                                       name="correo" 
                                       class="form-control" 
                                       value="{{ proveedor.correo }}">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="edit_tipo_empresa">Tipo de Empresa</label>
                                <select id="edit_tipo_empresa" name="tipo_empresa" class="form-control">
                                    <option value="PERSONA NATURAL COLOMBIANA" {% if proveedor.tipo_empresa == "PERSONA NATURAL COLOMBIANA" %}selected{% endif %}>Persona Natural Colombiana</option>
                                    <option value="EMPRESA" {% if proveedor.tipo_empresa == "EMPRESA" %}selected{% endif %}>Empresa</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12">
                            <div class="form-group">
                                <label for="edit_direccion">Dirección</label>
                                <input type="text" 
                                       id="edit_direccion" 
                                       name="direccion" 
                                       class="form-control" 
                                       value="{{ proveedor.direccion }}">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">
                        Cancelar
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Guardar Cambios
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}