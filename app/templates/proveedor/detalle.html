{% extends "navbar.html" %}
{% load static %}

{% block title %}Detalle Proveedor - {{ proveedor.nombre }}{% endblock %}

{% block content %}
<!-- Content Header -->
  <div class="content-header">
    <div class="container-fluid">
      <div class="row mb-2">
        <div class="col-sm-6">
          <h1 class="m-0">{{ proveedor.nombre }}</h1>
          <p class="text-muted">NIT: {{ proveedor.nit }}</p>
        </div>
        <div class="col-sm-6">
          <ol class="breadcrumb float-sm-right">
            <li class="breadcrumb-item"><a href="{% url 'index' %}">Inicio</a></li>
            <li class="breadcrumb-item"><a href="{% url 'proveedor:index' %}">Proveedores</a></li>
            <li class="breadcrumb-item active">{{ proveedor.nombre|truncatechars:30 }}</li>
          </ol>
        </div>
      </div>
    </div>
  </div>

  <!-- Main content -->
  <section class="content">
    <div class="container-fluid">
      
      <!-- Información básica -->
      <div class="row">
        <div class="col-md-8">
          <div class="card card-primary">
            <div class="card-header">
              <h3 class="card-title">Información del Proveedor</h3>
            </div>
            
            <form method="post" id="proveedorForm">
              {% csrf_token %}
              <div class="card-body">
                
                <!-- Información básica no editable -->
                <div class="row">
                  <div class="col-md-6">
                    <div class="form-group">
                      <label>NIT</label>
                      <input type="text" class="form-control" value="{{ proveedor.nit }}" readonly>
                      <small class="form-text text-muted">El NIT no se puede modificar</small>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-group">
                      <label>Tipo de Proveedor</label>
                      <input type="text" class="form-control" value="{{ proveedor.tipo_empresa}}" readonly>
                    </div>
                  </div>
                </div>
                
                <!-- Información editable -->
                <div class="form-group">
                  <label for="nombre">Nombre/Razón Social <span class="text-danger">*</span></label>
                  <input type="text" 
                         class="form-control" 
                         id="nombre" 
                         name="nombre" 
                         value="{{ proveedor.nombre }}"
                         required>
                </div>
                
                <div class="row">
                  <div class="col-md-6">
                    <div class="form-group">
                      <label for="telefono">Teléfono</label>
                      <input type="tel" 
                             class="form-control" 
                             id="telefono" 
                             name="telefono" 
                             value="{{ proveedor.telefono|default:'' }}">
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-group">
                      <label for="correo">Correo Electrónico</label>
                      <input type="email" 
                             class="form-control" 
                             id="correo" 
                             name="correo" 
                             value="{{ proveedor.correo|default:'' }}">
                    </div>
                  </div>
                </div>
                
                <div class="form-group">
                  <label for="direccion">Dirección</label>
                  <textarea class="form-control" 
                           id="direccion" 
                           name="direccion" 
                           rows="2">{{ proveedor.direccion|default:'' }}</textarea>
                </div>
                
                <!-- Información de representante legal -->
                {% if necesita_rep_legal %}
                <hr>
                <h5>Información del Representante Legal</h5>
                
                <div class="row">
                  <div class="col-md-6">
                    <div class="form-group">
                      <label for="nombre_representante_legal">Nombre Representante Legal</label>
                      <input type="text" 
                             class="form-control" 
                             id="nombre_representante_legal" 
                             name="nombre_representante_legal" 
                             value="{{ proveedor.nombre_representante_legal|default:'' }}">
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-group">
                      <label for="numero_doc_representante_legal">Número de Documento</label>
                      <input type="text" 
                             class="form-control" 
                             id="numero_doc_representante_legal" 
                             name="numero_doc_representante_legal" 
                             value="{{ proveedor.numero_doc_representante_legal|default:'' }}">
                    </div>
                  </div>
                </div>
                
                <div class="row">
                  <div class="col-md-6">
                    <div class="form-group">
                      <label for="telefono_representante_legal">Teléfono Rep. Legal</label>
                      <input type="tel" 
                             class="form-control" 
                             id="telefono_representante_legal" 
                             name="telefono_representante_legal" 
                             value="{{ proveedor.telefono_representante_legal|default:'' }}">
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-group">
                      <label for="correo_representante_legal">Correo Rep. Legal</label>
                      <input type="email" 
                             class="form-control" 
                             id="correo_representante_legal" 
                             name="correo_representante_legal" 
                             value="{{ proveedor.correo_representante_legal|default:'' }}">
                    </div>
                  </div>
                </div>
                {% endif %}
                
              </div>
              
              <div class="card-footer">
                <button type="submit" class="btn btn-success mr-2" id="btnGuardar">
                  Guardar Cambios
                </button>
                <a href="{% url 'proveedor:listar' %}" class="btn btn-secondary">
                  Volver a Lista
                </a>
                <a href="{% url 'proveedor:index' %}" class="btn btn-info">
                  Ir a Inicio
                </a>
              </div>
            </form>
          </div>
        </div>
        
        <!-- Sidebar con información adicional -->
        <div class="col-md-4">
          
          <!-- Ayuda -->
          <div class="card card-warning">
            <div class="card-header">
              <h3 class="card-title">Ayuda</h3>
            </div>
            <div class="card-body">
              <h6>Campos Editables</h6>
              <p class="text-sm">
                Puedes modificar el nombre, teléfono, correo y dirección del proveedor.
              </p>
              
              <h6>Campos Protegidos</h6>
              <p class="text-sm">
                El NIT y tipo de empresa no se pueden modificar una vez registrado 
                el proveedor por motivos de integridad de datos.
              </p>
            </div>
          </div>
        </div>
      </div>
  </section>

<!-- Scripts -->
<script src="{% static 'lib/adminlt320/plugins/jquery/jquery.min.js' %}"></script>
<script src="{% static 'lib/bootstrap533dist/js/bootstrap.bundle.min.js' %}"></script>
<script src="{% static 'lib/adminlt320/dist/js/adminlte.min.js' %}"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.1.4/toastr.min.js"></script>

<script>
$(document).ready(function() {
    // Configurar toastr
    toastr.options = {
        "closeButton": true,
        "timeOut": "5000"
    };
    
    // Validar formulario antes de enviar
    $('#proveedorForm').on('submit', function(e) {
        var nombre = $('#nombre').val().trim();
        
        if (!nombre || nombre.length < 3) {
            e.preventDefault();
            toastr.error('El nombre debe tener al menos 3 caracteres');
            $('#nombre').focus();
            return false;
        }
        
        // Deshabilitar botón para evitar doble envío
        $('#btnGuardar').prop('disabled', true).text('Guardando...');
    });
    
    // Función para exportar PDF
    window.exportarPDF = function() {
        toastr.info('Función de exportar PDF en desarrollo');
    };
    
    // Mostrar mensajes de Django
    {% if messages %}
        {% for message in messages %}
            {% if message.tags == 'success' %}
                toastr.success('{{ message }}');
            {% elif message.tags == 'error' %}
                toastr.error('{{ message }}');
            {% elif message.tags == 'warning' %}
                toastr.warning('{{ message }}');
            {% else %}
                toastr.info('{{ message }}');
            {% endif %}
        {% endfor %}
    {% endif %}
});
</script>
{% endblock %}